---
title: "Annual Data Validation"
author: "Air Quality Section | Regional Operations Branch"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    df_print: paged
params:
  preppedData: "./regionalPreppedData/Kootenay_1of2.rds"
  year: 2019
---

```{r setup,echo=FALSE,warning=FALSE,message=FALSE}
knitr::opts_chunk$set(warning = FALSE,
                      message = FALSE,
                      echo = FALSE)

library(tidyverse)
library(openair)
library(Hmisc)
library(xts)
library(plotly)
library(RCurl)
library(DT)
library(feather)
library(magrittr)
library(readxl)
library(gdata)

# functions to calculate SAS stats from hourly data
source("./SAS_from_ftpData/pm25sasFcn.R")
source("./SAS_from_ftpData/pm10sasFcn.R")
source("./SAS_from_ftpData/no2sasFcn.R")
source("./SAS_from_ftpData/nosasFcn.R")
source("./SAS_from_ftpData/so2sasFcn.R")
source("./SAS_from_ftpData/o3sasFcn.R")
source("./SAS_from_ftpData/h2ssasFcn.R")
source("./SAS_from_ftpData/trssasFcn.R")
source("./SAS_from_ftpData/cosasFcn.R")

# path to ecms sas reports saved locally:
sasReports<-"C:/HagaR/AnnualDataValidation/SAS_reports"

source("plotlyFcn.R")
source("emptyPlot.R")

```

```{r importData}
data<-readRDS(params$preppedData) 

```
# {.tabset}

## Data Summary

**Stations selected include: `r data %>% dplyr::pull(STATION_NAME_FULL) %>% unique %>% sort`.**

```{r dataSummary}
# FOR TESTING
# data %>%
#   dplyr::distinct(STATION_NAME_FULL, PARAMETER, INSTRUMENT) %>%
#   arrange(STATION_NAME_FULL) %>% View(.)


DT::datatable(data %>%
                dplyr::distinct(STATION_NAME_FULL,PARAMETER,INSTRUMENT) %>%
                arrange(STATION_NAME_FULL),
              caption = "Summary of data selected for validation.",
              rownames = FALSE)
```


## SAS Statistics {.tabset}

**To-do: add ECMS's SAS stats to table for comparison**

### PM~2.5~
```{r pm25sas}
pm25sas<-purrr::map_dfr((data %>%
                dplyr::filter(PARAMETER %in% "PM25") %>%
                dplyr::distinct(STATION_NAME_FULL) %>%
                arrange(STATION_NAME_FULL))$STATION_NAME_FULL,

             function(station){
                #for testing
               # station<-stations[1]
               
               stn<-data %>%
                 dplyr::filter(PARAMETER %in% "PM25" &
                                 STATION_NAME_FULL %in% station)

               purrr::map_dfr(unique(stn$INSTRUMENT),

                 function(instrument){
                   
                   # FOR TESTING
                   # instrument<-"BAM 9800"

                   inst<-stn %>%
                     dplyr::filter(INSTRUMENT %in% instrument)

                   pm25SASFcn(data=inst)

                 }) #INSTRUMENT LOOP

             }) #STATION LOOP

# add column origin for where calculations originate from
pm25sas %<>% dplyr::mutate(ORIGIN="AQS")

```

```{r pm25sasECMS}

pm25sasECMS <- readxl::read_excel(
  file.path(sasReports,
            "2019_PM2.5_UNSUPPRESSED.xlsx"))

# get pm25 stations in data
pm25Stns<-data %>%
  dplyr::filter(PARAMETER=="PM25") %>%
  dplyr::pull(STATION_NAME) %>%
  unique

pm25sasECMS %<>%
  dplyr::select(-c(`EMS ID`,
                   `NAPS ID`,
                   REGION,
                   OWNER,
                   UNIT)) %>%
  dplyr::filter(YEAR == params$year &
                  `STATION NAME` %in% stringr::str_replace(pm25Stns,
                                                           "_", " ")) %>%
  dplyr::mutate(ORIGIN = "ECMS")
```

```{r pm25sasDT}
names(pm25sasECMS)<-names(pm25sas)

# issues with binding, mismatching column formats (character vs integer), not being able to convert from one form to the other. Convert everything to character for data table.
pm25sasDT <- bind_rows(
  pm25sasECMS %>%
    dplyr::mutate_all(as.character) %>%
    dplyr::mutate(`STATION NAME` = toupper(`STATION NAME`)),
  
  pm25sas %>%
    mutate_all(as.character)
  
) %>%
  dplyr::arrange(`STATION NAME`) %>%
  dplyr::select(ORIGIN, everything())

if(nrow(pm25sasDT)!=0) {
 
   DT::datatable(
    pm25sasDT,
    caption = "ECMS and AQS calculated statistics.There will be one fewer valid hour compared to ECMS stats, I'll try to resolve this for next year.",
    options = list(
      scrollX = TRUE,
      scroller = TRUE,
      scrollY = 300,
      searching = TRUE,
      paging = TRUE,
      pageLength = 25
    )
  )
} else {
  print("There is no data for this parameter.")
}
```


### PM~10~
```{r pm10sas}

pm10sas<-purrr::map_dfr((data %>%
                dplyr::filter(PARAMETER %in% "PM10") %>%
                dplyr::distinct(STATION_NAME_FULL) %>%
                arrange(STATION_NAME_FULL))$STATION_NAME_FULL,

             function(station){

               station<-data %>%
                 dplyr::filter(PARAMETER %in% "PM10" &
                                 STATION_NAME_FULL %in% station)

               purrr::map_dfr(unique(station$INSTRUMENT),

                 function(instrument){

                   instrument<-station %>%
                     dplyr::filter(INSTRUMENT %in% instrument)

                   pm10SASFcn(data=instrument)

                 }) #INSTRUMENT LOOP

             }) #STATION LOOP

# add column origin for where calculations originate from
pm10sas %<>% dplyr::mutate(ORIGIN="AQS")

```


```{r pm10sasECMS}
# get pm10 stations in data
pm10Stns<-data %>%
  dplyr::filter(PARAMETER=="PM10") %>%
  dplyr::pull(STATION_NAME) %>%
  unique

# import ecms sas from excel
pm10sasECMS <- readxl::read_excel(
  file.path(sasReports,                                            "2019_PM10_UNSUPPRESSED.xlsx")) %>%

# remove secondary header row
dplyr::slice(-1) %>%
  
  # remove quarterly capture (duplicated)
  dplyr::select(-c(40:43), -c(`EMS ID`,
                              `NAPS ID`,
                              REGION,
                              OWNER,
                              UNIT)) %>%
  # FOR SUMMARY TABLE
  dplyr::mutate(ORIGIN = "ECMS") %>%
  # FILTER FOR YEAR AND STATIONS
  dplyr::filter(YEAR == params$year &
                  `STATION NAME` %in% stringr::str_replace(pm10Stns, "_", " "))


# MATCH NAMES AND DATA STRUCTURE - ORDER OF DAILY EXCEEDANCES, 98P , 3-YR 98P IS MISMATCHED.

# tibble::tibble(names(pm10sasECMS),
#                names(pm10sas)) %>% View

pm10sasECMS %<>%
  dplyr::select(1:31,33,34,32,everything())

names(pm10sasECMS) <- names(pm10sas)
 
```

```{r pm10sasDT}

# issues with binding, mismatching column formats (character vs integer), not being able to convert from one form to the other. Convert everything to character for data table.
pm10sasDT <- bind_rows(
  pm10sasECMS %>%
    dplyr::mutate_all(as.character) %>%
    dplyr::mutate(`STATION NAME` = toupper(`STATION NAME`)),
  
  pm10sas %>%
    mutate_all(as.character)
  
) %>%
  dplyr::arrange(`STATION NAME`) %>%
  dplyr::select(ORIGIN, everything())

if(nrow(pm10sasDT)!=0) {
 
   DT::datatable(
    pm10sasDT,
    caption = "ECMS and AQS calculated statistics.There will be one fewer valid hour compared to ECMS stats, I'll try to resolve this for next year.",
    options = list(
      scrollX = TRUE,
      scroller = TRUE,
      scrollY = 300,
      searching = TRUE,
      paging = TRUE,
      pageLength = 25
    )
  )
} else {
  print("There is no data for this parameter.")
}
```

### NO~2~

```{r no2sas}

no2sas<-purrr::map_dfr((data %>%
                dplyr::filter(PARAMETER %in% toupper("no2")) %>%
                dplyr::distinct(STATION_NAME_FULL) %>%
                arrange(STATION_NAME_FULL))$STATION_NAME_FULL,

             function(station){

               station<-data %>%
                 dplyr::filter(PARAMETER %in% toupper("no2") &
                                 STATION_NAME_FULL %in% station)

               purrr::map_dfr(unique(station$INSTRUMENT),

                 function(instrument){

                   instrument<-station %>%
                     dplyr::filter(INSTRUMENT %in% instrument)

                   no2SASFcn(data=instrument)

                 }) #INSTRUMENT LOOP

             }) #STATION LOOP

# add column origin for where calculations originate from
no2sas %<>% dplyr::mutate(ORIGIN="AQS")

```

```{r no2sasECMS}
# get no2 stations in data
no2Stns<-data %>%
  dplyr::filter(PARAMETER==toupper("no2")) %>%
  dplyr::pull(STATION_NAME) %>%
  unique

# import ecms sas from excel
no2sasECMS <- readxl::read_excel(
  file.path(sasReports,                                            "2019_NO2_UNSUPPRESSED.xlsx")) %>%
  
  # remove unneeded columna
  dplyr::select(-c(`EMS ID`,                    
                   `NAPS ID`,
                   REGION,
                   OWNER,
                   UNIT)) %>% 

# remove secondary header row
dplyr::slice(-1) %>%

  # FOR SUMMARY TABLE
  dplyr::mutate(ORIGIN = "ECMS") %>%
  # FILTER FOR YEAR AND STATIONS
  dplyr::filter(YEAR == params$year &
                  `STATION NAME` %in% stringr::str_replace(no2Stns, "_", " "))


# tibble::tibble(names(no2sasECMS),
#                names(no2sas)) %>% View

names(no2sasECMS) <- names(no2sas)
 
```

```{r no2sasDT}

# issues with binding, mismatching column formats (character vs integer), not being able to convert from one form to the other. Convert everything to character for data table.
no2sasDT <- bind_rows(
  no2sasECMS %>%
    dplyr::mutate_all(as.character) %>%
    dplyr::mutate(`STATION NAME` = toupper(`STATION NAME`)),
  
  no2sas %>%
    mutate_all(as.character)
  
) %>%
  dplyr::arrange(`STATION NAME`) %>%
  dplyr::select(ORIGIN, everything())

if(nrow(no2sasDT)!=0) {
 
   DT::datatable(
    no2sasDT,
    caption = "ECMS and AQS calculated statistics.There will be one fewer valid hour compared to ECMS stats, I'll try to resolve this for next year.",
    options = list(
      scrollX = TRUE,
      scroller = TRUE,
      scrollY = 300,
      searching = TRUE,
      paging = TRUE,
      pageLength = 25
    )
  )
} else {
  print("There is no data for this parameter.")
}
```


### NO

```{r nosas}

nosas<-purrr::map_dfr((data %>%
                dplyr::filter(PARAMETER %in% toupper("no")) %>%
                dplyr::distinct(STATION_NAME_FULL) %>%
                arrange(STATION_NAME_FULL))$STATION_NAME_FULL,

             function(station){

               station<-data %>%
                 dplyr::filter(PARAMETER %in% toupper("no") &
                                 STATION_NAME_FULL %in% station)

               purrr::map_dfr(unique(station$INSTRUMENT),

                 function(instrument){

                   instrument<-station %>%
                     dplyr::filter(INSTRUMENT %in% instrument)

                   noSASFcn(data=instrument)

                 }) #INSTRUMENT LOOP

             }) #STATION LOOP

  # add column origin for where calculations originate from
nosas %<>% dplyr::mutate(ORIGIN="AQS")

```

```{r nosasECMS}
# get no stations in data
noStns<-data %>%
  dplyr::filter(PARAMETER==toupper("no")) %>%
  dplyr::pull(STATION_NAME) %>%
  unique

# import ecms sas from excel
nosasECMS <- readxl::read_excel(
  file.path(sasReports,                                            "2019_NO_UNSUPPRESSED.xlsx")) %>%
  
  # remove unneeded columna
  dplyr::select(-c(`EMS ID`,                    
                   `NAPS ID`,
                   REGION,
                   OWNER,
                   UNIT)) %>% 

# remove secondary header row
dplyr::slice(-1) %>%

  # FOR SUMMARY TABLE
  dplyr::mutate(ORIGIN = "ECMS") %>%
  # FILTER FOR YEAR AND STATIONS
  dplyr::filter(YEAR == params$year &
                  `STATION NAME` %in% stringr::str_replace(noStns, "_", " "))


# tibble::tibble(names(nosasECMS),
#                names(nosas)) %>% View

names(nosasECMS) <- names(nosas)
 
```

```{r nosasDT}

# issues with binding, mismatching column formats (character vs integer), not being able to convert from one form to the other. Convert everything to character for data table.
nosasDT <- bind_rows(
  nosasECMS %>%
    dplyr::mutate_all(as.character) %>%
    dplyr::mutate(`STATION NAME` = toupper(`STATION NAME`)),
  
  nosas %>%
    mutate_all(as.character)
  
) %>%
  dplyr::arrange(`STATION NAME`) %>%
  dplyr::select(ORIGIN, everything())

if(nrow(nosasDT)!=0) {
 
   DT::datatable(
    nosasDT,
    caption = "ECMS and AQS calculated statistics.There will be one fewer valid hour compared to ECMS stats, I'll try to resolve this for next year.",
    options = list(
      scrollX = TRUE,
      scroller = TRUE,
      scrollY = 300,
      searching = TRUE,
      paging = TRUE,
      pageLength = 25
    )
  )
} else {
  print("There is no data for this parameter.")
}
```


### SO~2~

```{r so2sas}

so2sas<-purrr::map_dfr((data %>%
                dplyr::filter(PARAMETER %in% toupper("so2")) %>%
                dplyr::distinct(STATION_NAME_FULL) %>%
                arrange(STATION_NAME_FULL))$STATION_NAME_FULL,

             function(station){

               station<-data %>%
                 dplyr::filter(PARAMETER %in% toupper("so2") &
                                 STATION_NAME_FULL %in% station)

               purrr::map_dfr(unique(station$INSTRUMENT),

                 function(instrument){

                   instrument<-station %>%
                     dplyr::filter(INSTRUMENT %in% instrument)

                   so2SASFcn(data=instrument)

                 }) #INSTRUMENT LOOP

             }) #STATION LOOP

  if(nrow(so2sas!=0)){
  DT::datatable(so2sas,
                options = list(scrollX=TRUE))
  } else {print("There is no data for this parameter.")}

```

### O~3~

```{r o3sas}

o3sas<-purrr::map_dfr((data %>%
                dplyr::filter(PARAMETER %in% toupper("o3")) %>%
                dplyr::distinct(STATION_NAME_FULL) %>%
                arrange(STATION_NAME_FULL))$STATION_NAME_FULL,

             function(station){

               station<-data %>%
                 dplyr::filter(PARAMETER %in% toupper("o3") &
                                 STATION_NAME_FULL %in% station)

               purrr::map_dfr(unique(station$INSTRUMENT),

                 function(instrument){

                   instrument<-station %>%
                     dplyr::filter(INSTRUMENT %in% instrument)

                   o3SASFcn(data=instrument)

                 }) #INSTRUMENT LOOP

             }) #STATION LOOP

  if(nrow(o3sas!=0)){
  DT::datatable(o3sas,
                options = list(scrollX=TRUE))
  } else {print("There is no data for this parameter.")}

```

### H~2~S

```{r h2ssas}

h2ssas<-purrr::map_dfr((data %>%
                dplyr::filter(PARAMETER %in% toupper("h2s")) %>%
                dplyr::distinct(STATION_NAME_FULL) %>%
                arrange(STATION_NAME_FULL))$STATION_NAME_FULL,

             function(station){

               station<-data %>%
                 dplyr::filter(PARAMETER %in% toupper("h2s") &
                                 STATION_NAME_FULL %in% station)

               purrr::map_dfr(unique(station$INSTRUMENT),

                 function(instrument){

                   instrument<-station %>%
                     dplyr::filter(INSTRUMENT %in% instrument)

                   h2sSASFcn(data=instrument)

                 }) #INSTRUMENT LOOP

             }) #STATION LOOP

  if(nrow(h2ssas!=0)){
  DT::datatable(h2ssas,
                options = list(scrollX=TRUE))
  } else {print("There is no data for this parameter.")}

```

### TRS

```{r trssas}

trssas<-purrr::map_dfr((data %>%
                dplyr::filter(PARAMETER %in% toupper("trs")) %>%
                dplyr::distinct(STATION_NAME_FULL) %>%
                arrange(STATION_NAME_FULL))$STATION_NAME_FULL,

             function(station){

               station<-data %>%
                 dplyr::filter(PARAMETER %in% toupper("trs") &
                                 STATION_NAME_FULL %in% station)

               purrr::map_dfr(unique(station$INSTRUMENT),

                 function(instrument){

                   instrument<-station %>%
                     dplyr::filter(INSTRUMENT %in% instrument)

                   trsSASFcn(data=instrument)

                 }) #INSTRUMENT LOOP

             }) #STATION LOOP

  if(nrow(trssas!=0)){
  DT::datatable(trssas,
                options = list(scrollX=TRUE))
  } else {print("There is no data for this parameter.")}

```

### CO

```{r cosas}

cosas<-purrr::map_dfr((data %>%
                dplyr::filter(PARAMETER %in% toupper("co")) %>%
                dplyr::distinct(STATION_NAME_FULL) %>%
                arrange(STATION_NAME_FULL))$STATION_NAME_FULL,

             function(station){

               station<-data %>%
                 dplyr::filter(PARAMETER %in% toupper("co") &
                                 STATION_NAME_FULL %in% station)

               purrr::map_dfr(unique(station$INSTRUMENT),

                 function(instrument){

                   instrument<-station %>%
                     dplyr::filter(INSTRUMENT %in% instrument)

                   coSASFcn(data=instrument)

                 }) #INSTRUMENT LOOP

             }) #STATION LOOP

  if(nrow(cosas!=0)){
  DT::datatable(cosas,
                options = list(scrollX=TRUE))
  } else {print("There is no data for this parameter.")}

```

## Hourly time series {.tabset}

### PM~2.5~

```{r pm25hourly}
pm25plots<-if(
  
  (data %>% 
       dplyr::filter(PARAMETER %in% toupper("pm25")) %>%
       group_by_at(vars(STATION_NAME_FULL,INSTRUMENT)) %>%
       distinct(STATION_NAME_FULL,INSTRUMENT) %>%
       nrow(.))==0
  
) {emptyPlot} else {
  
  plotlyFcn(data,
            parameter=toupper("pm25"))
  
  
}

htmltools::tagList(pm25plots)
```


### PM~10~

```{r pm10hourly}
pm10plots<-if(
  
  (data %>% 
       dplyr::filter(PARAMETER %in% toupper("pm10")) %>%
       group_by_at(vars(STATION_NAME_FULL,INSTRUMENT)) %>%
       distinct(STATION_NAME_FULL,INSTRUMENT) %>%
       nrow(.))==0
  
) {emptyPlot} else {
  
  plotlyFcn(data,
            parameter=toupper("pm10"))
  
  
}

htmltools::tagList(pm10plots)
```

### O~3~

```{r o3hourly}
o3plots<-if(
  
  (data %>% 
       dplyr::filter(PARAMETER %in% toupper("o3")) %>%
       group_by_at(vars(STATION_NAME_FULL,INSTRUMENT)) %>%
       distinct(STATION_NAME_FULL,INSTRUMENT) %>%
       nrow(.))==0
  
) {emptyPlot} else {
  
  plotlyFcn(data,
            parameter=toupper("o3"))
  
  
}

htmltools::tagList(o3plots)
```

### NO~2~

```{r no2hourly}
no2plots<-if(
  
  (data %>% 
       dplyr::filter(PARAMETER %in% toupper("no2")) %>%
       group_by_at(vars(STATION_NAME_FULL,INSTRUMENT)) %>%
       distinct(STATION_NAME_FULL,INSTRUMENT) %>%
       nrow(.))==0
  
) {emptyPlot} else {
  
  plotlyFcn(data,
            parameter=toupper("no2"))
  
  
}

htmltools::tagList(no2plots)
```

### NO

```{r nohourly}
noplots<-if(
  
  (data %>% 
       dplyr::filter(PARAMETER %in% toupper("no")) %>%
       group_by_at(vars(STATION_NAME_FULL,INSTRUMENT)) %>%
       distinct(STATION_NAME_FULL,INSTRUMENT) %>%
       nrow(.))==0
  
) {emptyPlot} else {
  
  plotlyFcn(data,
            parameter=toupper("no"))
  
  
}

htmltools::tagList(noplots)
```

### NO~x~

```{r noxhourly}
noxplots<-if(
  
  (data %>% 
       dplyr::filter(PARAMETER %in% "NOx") %>%
       group_by_at(vars(STATION_NAME_FULL,INSTRUMENT)) %>%
       distinct(STATION_NAME_FULL,INSTRUMENT) %>%
       nrow(.))==0
  
) {emptyPlot} else {
  
  plotlyFcn(data,
            parameter="NOx")
  
  
}

htmltools::tagList(noxplots)
```


### SO~2~

```{r so2hourly}
so2plots<-if(
  
  (data %>% 
       dplyr::filter(PARAMETER %in% toupper("so2")) %>%
       group_by_at(vars(STATION_NAME_FULL,INSTRUMENT)) %>%
       distinct(STATION_NAME_FULL,INSTRUMENT) %>%
       nrow(.))==0
  
) {emptyPlot} else {
  
  plotlyFcn(data,
            parameter=toupper("so2"))
  
  
}

htmltools::tagList(so2plots)
```

### CO

```{r cohourly}
coplots<-if(
  
  (data %>% 
       dplyr::filter(PARAMETER %in% toupper("co")) %>%
       group_by_at(vars(STATION_NAME_FULL,INSTRUMENT)) %>%
       distinct(STATION_NAME_FULL,INSTRUMENT) %>%
       nrow(.))==0
  
) {emptyPlot} else {
  
  plotlyFcn(data,
            parameter=toupper("co"))
  
  
}

htmltools::tagList(coplots)
```

### TRS

```{r trshourly}
trsplots<-if(
  
  (data %>% 
       dplyr::filter(PARAMETER %in% toupper("trs")) %>%
       group_by_at(vars(STATION_NAME_FULL,INSTRUMENT)) %>%
       distinct(STATION_NAME_FULL,INSTRUMENT) %>%
       nrow(.))==0
  
) {emptyPlot} else {
  
  plotlyFcn(data,
            parameter=toupper("trs"))
  
  
}

htmltools::tagList(trsplots)
```

### H~2~S

```{r h2shourly}
h2splots<-if(
  
  (data %>% 
       dplyr::filter(PARAMETER %in% toupper("h2s")) %>%
       group_by_at(vars(STATION_NAME_FULL,INSTRUMENT)) %>%
       distinct(STATION_NAME_FULL,INSTRUMENT) %>%
       nrow(.))==0
  
) {emptyPlot} else {
  
  plotlyFcn(data,
            parameter=toupper("h2s"))
  
  
}

htmltools::tagList(h2splots)
```

### WS

Something to look for: ws/wd lock due to rime on the anemometer or vane, data coming online after long periods (multiple hours) of being offline only to have the first hour read high, then all subsequent hours much lower.

```{r wspd_sclrhourly}
wspd_sclrplots<-if(
  
  (data %>% 
       dplyr::filter(PARAMETER %in% toupper("wspd_sclr")) %>%
       group_by_at(vars(STATION_NAME_FULL,INSTRUMENT)) %>%
       distinct(STATION_NAME_FULL,INSTRUMENT) %>%
       nrow(.))==0
  
) {emptyPlot} else {
  
  plotlyFcn(data,
            parameter=toupper("wspd_sclr"))
  
  
}

htmltools::tagList(wspd_sclrplots)
```

### WD

Something to look for: ws/wd lock due to rime on the anemometer or vane, data coming online after long periods (multiple hours) of being offline only to have the first hour read high, then all subsequent hours much lower.

```{r wdir_vecthourly}
wdir_vectplots<-if(
  
  (data %>% 
       dplyr::filter(PARAMETER %in% toupper("wdir_vect")) %>%
       group_by_at(vars(STATION_NAME_FULL,INSTRUMENT)) %>%
       distinct(STATION_NAME_FULL,INSTRUMENT) %>%
       nrow(.))==0
  
) {emptyPlot} else {
  
  plotlyFcn(data,
            parameter=toupper("wdir_vect"))
  
  
}

htmltools::tagList(wdir_vectplots)
```

### Temp

```{r temp_meanhourly}
temp_meanplots<-if(
  
  (data %>% 
       dplyr::filter(PARAMETER %in% toupper("temp_mean")) %>%
       group_by_at(vars(STATION_NAME_FULL,INSTRUMENT)) %>%
       distinct(STATION_NAME_FULL,INSTRUMENT) %>%
       nrow(.))==0
  
) {emptyPlot} else {
  
  plotlyFcn(data,
            parameter=toupper("temp_mean"))
  
  
}

htmltools::tagList(temp_meanplots)
```

### Humidity

```{r humidityhourly}
humidityplots<-if(
  
  (data %>% 
       dplyr::filter(PARAMETER %in% toupper("humidity")) %>%
       group_by_at(vars(STATION_NAME_FULL,INSTRUMENT)) %>%
       distinct(STATION_NAME_FULL,INSTRUMENT) %>%
       nrow(.))==0
  
) {emptyPlot} else {
  
  plotlyFcn(data,
            parameter=toupper("humidity"))
  
  
}

htmltools::tagList(humidityplots)
```

## Box Plots {.tabset}

**To-do: add emptly plots when no data exists for parameter.(like with hourly plot)**

### PM~2.5~

```{r pm25monthly}
suppressWarnings(
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("PM25")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
    
  
    {
    
    #FOR TESTING - 9 total
# (station<-(data %>%
#              dplyr::filter(PARAMETER %in% toupper("PM25")) %>%
#              dplyr::pull(STATION_NAME_FULL) %>%
#              unique)[4])
    
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("pm25"))
    
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p<-ggplot(data = plotData,
           aes(x = reorder(format(DATE_PST, "%b"), DATE_PST), #alter this for different boxplots
               y = ROUNDED_VALUE,
               fill=STATION_NAME_FULL)
           ) +
      geom_boxplot() +
      labs(title = paste("Monthly Boxplot:",
                         station),
           x = "",
           y = stringr::str_c("Hourly PM2.5 (",
                              data %>%
                                dplyr::filter(PARAMETER %in% toupper("pm25")) %>%
                                dplyr::pull(UNIT) %>% unique, ")",
                              sep = ""
             )
           ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      )+ 
        scale_fill_brewer(palette = "Set1")+
      facet_wrap( ~ INSTRUMENT, scales = "free") 
    
  # Error in fix.by(by.y, y) : 'by' must specify uniquely valid columns
    plotly::ggplotly(p) 
    
    }  else{paste("There is no PM2.5 data for",station)}#end if and else
      
    } #end plot function
  
  )# end map
  
) #end tagList

) #end suppressWarnings

```

```{r pm25hebdomadal}
suppressWarnings(
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("PM25")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
  # station<-"Abbotsford A Columbia Street"
    {
    
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("pm25"))%>%
        dplyr::mutate(weekday=factor(format(DATE_PST,"%a"),
                                     c("Sun",
                                        "Mon",
                                        "Tue",
                                        "Wed",
                                        "Thu",
                                        "Fri",
                                        "Sat")))
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p <- ggplot(
      data = plotData ,
      aes(
        x = weekday,
        #alter this for different boxplots
        y = ROUNDED_VALUE,
        fill = STATION_NAME_FULL
      )
    ) +
      geom_boxplot() +
      scale_x_discrete()+
      labs(
        title = paste("Hebdomadal Boxplot:",station),
        x = "",
        y = stringr::str_c(
          "Hourly PM2.5 (",
          data %>%
            dplyr::filter(PARAMETER %in% toupper("pm25")) %>%
            dplyr::pull(UNIT) %>% unique,
          ")",
          sep = ""
        )
      ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      ) +
      scale_fill_brewer(palette = "Set1") +
      facet_wrap(~ INSTRUMENT, scales = "free")
    
    plotly::ggplotly(p)
    
    } else{paste("There is no PM2.5 data for",station)}#end if and else
    
      
    } #end plot function
  
  )# end map
  
) #end tagList

) # end suppressWarnings

```

```{r pm25diurnal}
suppressWarnings(
  
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("PM25")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
  # station<-"Abbotsford A Columbia Street"
    {
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("pm25"))
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p <- ggplot(
      data = plotData,
      aes(
        x = format(DATE_PST,"%H"),
        #alter this for different boxplots
        y = ROUNDED_VALUE,
        fill = STATION_NAME_FULL
      )
    ) +
      geom_boxplot() +
      scale_x_discrete()+
      labs(
        title = paste("Diurnal Boxplot:",station),
        x = "",
        y = stringr::str_c(
          "Hourly PM2.5 (",
          data %>%
            dplyr::filter(PARAMETER %in% toupper("pm25")) %>%
            dplyr::pull(UNIT) %>% unique,
          ")",
          sep = ""
        )
      ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      ) +
      scale_fill_brewer(palette = "Set1") +
      facet_wrap(~ INSTRUMENT, scales = "free")
    
    plotly::ggplotly(p)
    
    } else{paste("There is no PM2.5 data for",station)}#end if and else
    
    } #end plot function
  
  )# end map
  
) #end tagList

) #end suppressWarnings

```

### PM~10~

```{r pm10monthly}

suppressWarnings(
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("pm10")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
    
  
    {
    
    #FOR TESTING - 9 total
# (station<-(data %>%
#              dplyr::filter(PARAMETER %in% toupper("pm10")) %>%
#              dplyr::pull(STATION_NAME_FULL) %>%
#              unique)[4])
    
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("pm10"))
    
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p<-ggplot(data = plotData,
           aes(x = reorder(format(DATE_PST, "%b"), DATE_PST), #alter this for different boxplots
               y = ROUNDED_VALUE,
               fill=STATION_NAME_FULL)
           ) +
      geom_boxplot() +
      labs(title = paste("Monthly Boxplot:",
                         station),
           x = "",
           y = stringr::str_c("Hourly PM10 (",
                              data %>%
                                dplyr::filter(PARAMETER %in% toupper("pm10")) %>%
                                dplyr::pull(UNIT) %>% unique, ")",
                              sep = ""
             )
           ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      )+ 
        scale_fill_brewer(palette = "Set1")+
      facet_wrap( ~ INSTRUMENT, scales = "free") 
    
  # Error in fix.by(by.y, y) : 'by' must specify uniquely valid columns
    plotly::ggplotly(p) 
    
    }  else{paste("There is no PM10 data for",station)}#end if and else
      
    } #end plot function
  
  )# end map
  
) #end tagList

) #end suppressWarnings

```

```{r pm10hebdomadal}
suppressWarnings(
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("pm10")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
  # station<-"Abbotsford A Columbia Street"
    {
    
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("pm10"))%>%
        dplyr::mutate(weekday=factor(format(DATE_PST,"%a"),
                                     c("Sun",
                                        "Mon",
                                        "Tue",
                                        "Wed",
                                        "Thu",
                                        "Fri",
                                        "Sat")))
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p <- ggplot(
      data = plotData ,
      aes(
        x = weekday,
        #alter this for different boxplots
        y = ROUNDED_VALUE,
        fill = STATION_NAME_FULL
      )
    ) +
      geom_boxplot() +
      scale_x_discrete()+
      labs(
        title = paste("Hebdomadal Boxplot:",station),
        x = "",
        y = stringr::str_c(
          "Hourly pm10 (",
          data %>%
            dplyr::filter(PARAMETER %in% toupper("pm10")) %>%
            dplyr::pull(UNIT) %>% unique,
          ")",
          sep = ""
        )
      ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      ) +
      scale_fill_brewer(palette = "Set1") +
      facet_wrap(~ INSTRUMENT, scales = "free")
    
    plotly::ggplotly(p)
    
    } else{paste("There is no pm10 data for",station)}#end if and else
    
      
    } #end plot function
  
  )# end map
  
) #end tagList

) # end suppressWarnings

```

```{r pm10diurnal}
suppressWarnings(
  
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("pm10")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
  # station<-"Abbotsford A Columbia Street"
    {
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("pm10"))
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p <- ggplot(
      data = plotData,
      aes(
        x = format(DATE_PST,"%H"),
        #alter this for different boxplots
        y = ROUNDED_VALUE,
        fill = STATION_NAME_FULL
      )
    ) +
      geom_boxplot() +
      scale_x_discrete()+
      labs(
        title = paste("Diurnal Boxplot:",station),
        x = "",
        y = stringr::str_c(
          "Hourly pm10 (",
          data %>%
            dplyr::filter(PARAMETER %in% toupper("pm10")) %>%
            dplyr::pull(UNIT) %>% unique,
          ")",
          sep = ""
        )
      ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      ) +
      scale_fill_brewer(palette = "Set1") +
      facet_wrap(~ INSTRUMENT, scales = "free")
    
    plotly::ggplotly(p)
    
    } else{paste("There is no pm10 data for",station)}#end if and else
    
    } #end plot function
  
  )# end map
  
) #end tagList

) #end suppressWarnings

```


### O~3~

```{r o3monthly}

suppressWarnings(
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("o3")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
    
  
    {
    
    #FOR TESTING - 9 total
# (station<-(data %>%
#              dplyr::filter(PARAMETER %in% toupper("o3")) %>%
#              dplyr::pull(STATION_NAME_FULL) %>%
#              unique)[4])
    
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("o3"))
    
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p<-ggplot(data = plotData,
           aes(x = reorder(format(DATE_PST, "%b"), DATE_PST), #alter this for different boxplots
               y = ROUNDED_VALUE,
               fill=STATION_NAME_FULL)
           ) +
      geom_boxplot() +
      labs(title = paste("Monthly Boxplot:",
                         station),
           x = "",
           y = stringr::str_c("Hourly o3 (",
                              data %>%
                                dplyr::filter(PARAMETER %in% toupper("o3")) %>%
                                dplyr::pull(UNIT) %>% unique, ")",
                              sep = ""
             )
           ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      )+ 
        scale_fill_brewer(palette = "Set1")+
      facet_wrap( ~ INSTRUMENT, scales = "free") 
    
  # Error in fix.by(by.y, y) : 'by' must specify uniquely valid columns
    plotly::ggplotly(p) 
    
    }  else{paste("There is no o3 data for",station)}#end if and else
      
    } #end plot function
  
  )# end map
  
) #end tagList

) #end suppressWarnings

```

```{r o3hebdomadal}
suppressWarnings(
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("o3")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
  # station<-"Abbotsford A Columbia Street"
    {
    
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("o3"))%>%
        dplyr::mutate(weekday=factor(format(DATE_PST,"%a"),
                                     c("Sun",
                                        "Mon",
                                        "Tue",
                                        "Wed",
                                        "Thu",
                                        "Fri",
                                        "Sat")))
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p <- ggplot(
      data = plotData ,
      aes(
        x = weekday,
        #alter this for different boxplots
        y = ROUNDED_VALUE,
        fill = STATION_NAME_FULL
      )
    ) +
      geom_boxplot() +
      scale_x_discrete()+
      labs(
        title = paste("Hebdomadal Boxplot:",station),
        x = "",
        y = stringr::str_c(
          "Hourly o3 (",
          data %>%
            dplyr::filter(PARAMETER %in% toupper("o3")) %>%
            dplyr::pull(UNIT) %>% unique,
          ")",
          sep = ""
        )
      ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      ) +
      scale_fill_brewer(palette = "Set1") +
      facet_wrap(~ INSTRUMENT, scales = "free")
    
    plotly::ggplotly(p)
    
    } else{paste("There is no o3 data for",station)}#end if and else
    
      
    } #end plot function
  
  )# end map
  
) #end tagList

) # end suppressWarnings

```

```{r o3diurnal}
suppressWarnings(
  
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("o3")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
  # station<-"Abbotsford A Columbia Street"
    {
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("o3"))
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p <- ggplot(
      data = plotData,
      aes(
        x = format(DATE_PST,"%H"),
        #alter this for different boxplots
        y = ROUNDED_VALUE,
        fill = STATION_NAME_FULL
      )
    ) +
      geom_boxplot() +
      scale_x_discrete()+
      labs(
        title = paste("Diurnal Boxplot:",station),
        x = "",
        y = stringr::str_c(
          "Hourly o3 (",
          data %>%
            dplyr::filter(PARAMETER %in% toupper("o3")) %>%
            dplyr::pull(UNIT) %>% unique,
          ")",
          sep = ""
        )
      ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      ) +
      scale_fill_brewer(palette = "Set1") +
      facet_wrap(~ INSTRUMENT, scales = "free")
    
    plotly::ggplotly(p)
    
    } else{paste("There is no o3 data for",station)}#end if and else
    
    } #end plot function
  
  )# end map
  
) #end tagList

) #end suppressWarnings

```

### NO~2~

```{r no2monthly}

suppressWarnings(
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("no2")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
    
  
    {
    
    #FOR TESTING - 9 total
# (station<-(data %>%
#              dplyr::filter(PARAMETER %in% toupper("no2")) %>%
#              dplyr::pull(STATION_NAME_FULL) %>%
#              unique)[4])
    
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("no2"))
    
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p<-ggplot(data = plotData,
           aes(x = reorder(format(DATE_PST, "%b"), DATE_PST), #alter this for different boxplots
               y = ROUNDED_VALUE,
               fill=STATION_NAME_FULL)
           ) +
      geom_boxplot() +
      labs(title = paste("Monthly Boxplot:",
                         station),
           x = "",
           y = stringr::str_c("Hourly no2 (",
                              data %>%
                                dplyr::filter(PARAMETER %in% toupper("no2")) %>%
                                dplyr::pull(UNIT) %>% unique, ")",
                              sep = ""
             )
           ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      )+ 
        scale_fill_brewer(palette = "Set1")+
      facet_wrap( ~ INSTRUMENT, scales = "free") 
    
  # Error in fix.by(by.y, y) : 'by' must specify uniquely valid columns
    plotly::ggplotly(p) 
    
    }  else{paste("There is no no2 data for",station)}#end if and else
      
    } #end plot function
  
  )# end map
  
) #end tagList

) #end suppressWarnings

```

```{r no2hebdomadal}
suppressWarnings(
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("no2")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
  # station<-"Abbotsford A Columbia Street"
    {
    
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("no2"))%>%
        dplyr::mutate(weekday=factor(format(DATE_PST,"%a"),
                                     c("Sun",
                                        "Mon",
                                        "Tue",
                                        "Wed",
                                        "Thu",
                                        "Fri",
                                        "Sat")))
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p <- ggplot(
      data = plotData ,
      aes(
        x = weekday,
        #alter this for different boxplots
        y = ROUNDED_VALUE,
        fill = STATION_NAME_FULL
      )
    ) +
      geom_boxplot() +
      scale_x_discrete()+
      labs(
        title = paste("Hebdomadal Boxplot:",station),
        x = "",
        y = stringr::str_c(
          "Hourly no2 (",
          data %>%
            dplyr::filter(PARAMETER %in% toupper("no2")) %>%
            dplyr::pull(UNIT) %>% unique,
          ")",
          sep = ""
        )
      ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      ) +
      scale_fill_brewer(palette = "Set1") +
      facet_wrap(~ INSTRUMENT, scales = "free")
    
    plotly::ggplotly(p)
    
    } else{paste("There is no no2 data for",station)}#end if and else
    
      
    } #end plot function
  
  )# end map
  
) #end tagList

) # end suppressWarnings

```

```{r no2diurnal}
suppressWarnings(
  
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("no2")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
  # station<-"Abbotsford A Columbia Street"
    {
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("no2"))
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p <- ggplot(
      data = plotData,
      aes(
        x = format(DATE_PST,"%H"),
        #alter this for different boxplots
        y = ROUNDED_VALUE,
        fill = STATION_NAME_FULL
      )
    ) +
      geom_boxplot() +
      scale_x_discrete()+
      labs(
        title = paste("Diurnal Boxplot:",station),
        x = "",
        y = stringr::str_c(
          "Hourly no2 (",
          data %>%
            dplyr::filter(PARAMETER %in% toupper("no2")) %>%
            dplyr::pull(UNIT) %>% unique,
          ")",
          sep = ""
        )
      ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      ) +
      scale_fill_brewer(palette = "Set1") +
      facet_wrap(~ INSTRUMENT, scales = "free")
    
    plotly::ggplotly(p)
    
    } else{paste("There is no no2 data for",station)}#end if and else
    
    } #end plot function
  
  )# end map
  
) #end tagList

) #end suppressWarnings

```

### NO

```{r nomonthly}

suppressWarnings(
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("no")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
    
  
    {
    
    #FOR TESTING - 9 total
# (station<-(data %>%
#              dplyr::filter(PARAMETER %in% toupper("no")) %>%
#              dplyr::pull(STATION_NAME_FULL) %>%
#              unique)[4])
    
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("no"))
    
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p<-ggplot(data = plotData,
           aes(x = reorder(format(DATE_PST, "%b"), DATE_PST), #alter this for different boxplots
               y = ROUNDED_VALUE,
               fill=STATION_NAME_FULL)
           ) +
      geom_boxplot() +
      labs(title = paste("Monthly Boxplot:",
                         station),
           x = "",
           y = stringr::str_c("Hourly no (",
                              data %>%
                                dplyr::filter(PARAMETER %in% toupper("no")) %>%
                                dplyr::pull(UNIT) %>% unique, ")",
                              sep = ""
             )
           ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      )+ 
        scale_fill_brewer(palette = "Set1")+
      facet_wrap( ~ INSTRUMENT, scales = "free") 
    
  # Error in fix.by(by.y, y) : 'by' must specify uniquely valid columns
    plotly::ggplotly(p) 
    
    }  else{paste("There is no no data for",station)}#end if and else
      
    } #end plot function
  
  )# end map
  
) #end tagList

) #end suppressWarnings

```

```{r nohebdomadal}
suppressWarnings(
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("no")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
  # station<-"Abbotsford A Columbia Street"
    {
    
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("no"))%>%
        dplyr::mutate(weekday=factor(format(DATE_PST,"%a"),
                                     c("Sun",
                                        "Mon",
                                        "Tue",
                                        "Wed",
                                        "Thu",
                                        "Fri",
                                        "Sat")))
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p <- ggplot(
      data = plotData ,
      aes(
        x = weekday,
        #alter this for different boxplots
        y = ROUNDED_VALUE,
        fill = STATION_NAME_FULL
      )
    ) +
      geom_boxplot() +
      scale_x_discrete()+
      labs(
        title = paste("Hebdomadal Boxplot:",station),
        x = "",
        y = stringr::str_c(
          "Hourly no (",
          data %>%
            dplyr::filter(PARAMETER %in% toupper("no")) %>%
            dplyr::pull(UNIT) %>% unique,
          ")",
          sep = ""
        )
      ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      ) +
      scale_fill_brewer(palette = "Set1") +
      facet_wrap(~ INSTRUMENT, scales = "free")
    
    plotly::ggplotly(p)
    
    } else{paste("There is no no data for",station)}#end if and else
    
      
    } #end plot function
  
  )# end map
  
) #end tagList

) # end suppressWarnings

```

```{r nodiurnal}
suppressWarnings(
  
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("no")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
  # station<-"Abbotsford A Columbia Street"
    {
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("no"))
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p <- ggplot(
      data = plotData,
      aes(
        x = format(DATE_PST,"%H"),
        #alter this for different boxplots
        y = ROUNDED_VALUE,
        fill = STATION_NAME_FULL
      )
    ) +
      geom_boxplot() +
      scale_x_discrete()+
      labs(
        title = paste("Diurnal Boxplot:",station),
        x = "",
        y = stringr::str_c(
          "Hourly no (",
          data %>%
            dplyr::filter(PARAMETER %in% toupper("no")) %>%
            dplyr::pull(UNIT) %>% unique,
          ")",
          sep = ""
        )
      ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      ) +
      scale_fill_brewer(palette = "Set1") +
      facet_wrap(~ INSTRUMENT, scales = "free")
    
    plotly::ggplotly(p)
    
    } else{paste("There is no no data for",station)}#end if and else
    
    } #end plot function
  
  )# end map
  
) #end tagList

) #end suppressWarnings

```

### NO~x~


```{r noxmonthly}

suppressWarnings(
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("nox")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
    
  
    {
    
    #FOR TESTING - 9 total
# (station<-(data %>%
#              dplyr::filter(PARAMETER %in% toupper("nox")) %>%
#              dplyr::pull(STATION_NAME_FULL) %>%
#              unique)[4])
    
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("nox"))
    
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p<-ggplot(data = plotData,
           aes(x = reorder(format(DATE_PST, "%b"), DATE_PST), #alter this for different boxplots
               y = ROUNDED_VALUE,
               fill=STATION_NAME_FULL)
           ) +
      geom_boxplot() +
      labs(title = paste("Monthly Boxplot:",
                         station),
           x = "",
           y = stringr::str_c("Hourly nox (",
                              data %>%
                                dplyr::filter(PARAMETER %in% toupper("nox")) %>%
                                dplyr::pull(UNIT) %>% unique, ")",
                              sep = ""
             )
           ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      )+ 
        scale_fill_brewer(palette = "Set1")+
      facet_wrap( ~ INSTRUMENT, scales = "free") 
    
  # Error in fix.by(by.y, y) : 'by' must specify uniquely valid columns
    plotly::ggplotly(p) 
    
    }  else{paste("There is no nox data for",station)}#end if and else
      
    } #end plot function
  
  )# end map
  
) #end tagList

) #end suppressWarnings

```

```{r noxhebdomadal}
suppressWarnings(
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("nox")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
  # station<-"Abbotsford A Columbia Street"
    {
    
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("nox"))%>%
        dplyr::mutate(weekday=factor(format(DATE_PST,"%a"),
                                     c("Sun",
                                        "Mon",
                                        "Tue",
                                        "Wed",
                                        "Thu",
                                        "Fri",
                                        "Sat")))
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p <- ggplot(
      data = plotData ,
      aes(
        x = weekday,
        #alter this for different boxplots
        y = ROUNDED_VALUE,
        fill = STATION_NAME_FULL
      )
    ) +
      geom_boxplot() +
      scale_x_discrete()+
      labs(
        title = paste("Hebdomadal Boxplot:",station),
        x = "",
        y = stringr::str_c(
          "Hourly nox (",
          data %>%
            dplyr::filter(PARAMETER %in% toupper("nox")) %>%
            dplyr::pull(UNIT) %>% unique,
          ")",
          sep = ""
        )
      ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      ) +
      scale_fill_brewer(palette = "Set1") +
      facet_wrap(~ INSTRUMENT, scales = "free")
    
    plotly::ggplotly(p)
    
    } else{paste("There is no nox data for",station)}#end if and else
    
      
    } #end plot function
  
  )# end map
  
) #end tagList

) # end suppressWarnings

```

```{r noxdiurnal}
suppressWarnings(
  
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("nox")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
  # station<-"Abbotsford A Columbia Street"
    {
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("nox"))
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p <- ggplot(
      data = plotData,
      aes(
        x = format(DATE_PST,"%H"),
        #alter this for different boxplots
        y = ROUNDED_VALUE,
        fill = STATION_NAME_FULL
      )
    ) +
      geom_boxplot() +
      scale_x_discrete()+
      labs(
        title = paste("Diurnal Boxplot:",station),
        x = "",
        y = stringr::str_c(
          "Hourly nox (",
          data %>%
            dplyr::filter(PARAMETER %in% toupper("nox")) %>%
            dplyr::pull(UNIT) %>% unique,
          ")",
          sep = ""
        )
      ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      ) +
      scale_fill_brewer(palette = "Set1") +
      facet_wrap(~ INSTRUMENT, scales = "free")
    
    plotly::ggplotly(p)
    
    } else{paste("There is no nox data for",station)}#end if and else
    
    } #end plot function
  
  )# end map
  
) #end tagList

) #end suppressWarnings

```

### SO~2~

```{r so2monthly}

suppressWarnings(
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("so2")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
    
  
    {
    
    #FOR TESTING - 9 total
# (station<-(data %>%
#              dplyr::filter(PARAMETER %in% toupper("so2")) %>%
#              dplyr::pull(STATION_NAME_FULL) %>%
#              unique)[4])
    
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("so2"))
    
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p<-ggplot(data = plotData,
           aes(x = reorder(format(DATE_PST, "%b"), DATE_PST), #alter this for different boxplots
               y = ROUNDED_VALUE,
               fill=STATION_NAME_FULL)
           ) +
      geom_boxplot() +
      labs(title = paste("Monthly Boxplot:",
                         station),
           x = "",
           y = stringr::str_c("Hourly so2 (",
                              data %>%
                                dplyr::filter(PARAMETER %in% toupper("so2")) %>%
                                dplyr::pull(UNIT) %>% unique, ")",
                              sep = ""
             )
           ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      )+ 
        scale_fill_brewer(palette = "Set1")+
      facet_wrap( ~ INSTRUMENT, scales = "free") 
    
  # Error in fix.by(by.y, y) : 'by' must specify uniquely valid columns
    plotly::ggplotly(p) 
    
    }  else{paste("There is no so2 data for",station)}#end if and else
      
    } #end plot function
  
  )# end map
  
) #end tagList

) #end suppressWarnings

```

```{r so2hebdomadal}
suppressWarnings(
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("so2")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
  # station<-"Abbotsford A Columbia Street"
    {
    
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("so2"))%>%
        dplyr::mutate(weekday=factor(format(DATE_PST,"%a"),
                                     c("Sun",
                                        "Mon",
                                        "Tue",
                                        "Wed",
                                        "Thu",
                                        "Fri",
                                        "Sat")))
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p <- ggplot(
      data = plotData ,
      aes(
        x = weekday,
        #alter this for different boxplots
        y = ROUNDED_VALUE,
        fill = STATION_NAME_FULL
      )
    ) +
      geom_boxplot() +
      scale_x_discrete()+
      labs(
        title = paste("Hebdomadal Boxplot:",station),
        x = "",
        y = stringr::str_c(
          "Hourly so2 (",
          data %>%
            dplyr::filter(PARAMETER %in% toupper("so2")) %>%
            dplyr::pull(UNIT) %>% unique,
          ")",
          sep = ""
        )
      ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      ) +
      scale_fill_brewer(palette = "Set1") +
      facet_wrap(~ INSTRUMENT, scales = "free")
    
    plotly::ggplotly(p)
    
    } else{paste("There is no so2 data for",station)}#end if and else
    
      
    } #end plot function
  
  )# end map
  
) #end tagList

) # end suppressWarnings

```

```{r so2diurnal}
suppressWarnings(
  
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("so2")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
  # station<-"Abbotsford A Columbia Street"
    {
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("so2"))
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p <- ggplot(
      data = plotData,
      aes(
        x = format(DATE_PST,"%H"),
        #alter this for different boxplots
        y = ROUNDED_VALUE,
        fill = STATION_NAME_FULL
      )
    ) +
      geom_boxplot() +
      scale_x_discrete()+
      labs(
        title = paste("Diurnal Boxplot:",station),
        x = "",
        y = stringr::str_c(
          "Hourly so2 (",
          data %>%
            dplyr::filter(PARAMETER %in% toupper("so2")) %>%
            dplyr::pull(UNIT) %>% unique,
          ")",
          sep = ""
        )
      ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      ) +
      scale_fill_brewer(palette = "Set1") +
      facet_wrap(~ INSTRUMENT, scales = "free")
    
    plotly::ggplotly(p)
    
    } else{paste("There is no so2 data for",station)}#end if and else
    
    } #end plot function
  
  )# end map
  
) #end tagList

) #end suppressWarnings

```

### CO

```{r comonthly}

suppressWarnings(
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("co")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
    
  
    {
    
    #FOR TESTING - 9 total
# (station<-(data %>%
#              dplyr::filter(PARAMETER %in% toupper("co")) %>%
#              dplyr::pull(STATION_NAME_FULL) %>%
#              unique)[4])
    
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("co"))
    
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p<-ggplot(data = plotData,
           aes(x = reorder(format(DATE_PST, "%b"), DATE_PST), #alter this for different boxplots
               y = ROUNDED_VALUE,
               fill=STATION_NAME_FULL)
           ) +
      geom_boxplot() +
      labs(title = paste("Monthly Boxplot:",
                         station),
           x = "",
           y = stringr::str_c("Hourly co (",
                              data %>%
                                dplyr::filter(PARAMETER %in% toupper("co")) %>%
                                dplyr::pull(UNIT) %>% unique, ")",
                              sep = ""
             )
           ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      )+ 
        scale_fill_brewer(palette = "Set1")+
      facet_wrap( ~ INSTRUMENT, scales = "free") 
    
  # Error in fix.by(by.y, y) : 'by' must specify uniquely valid columns
    plotly::ggplotly(p) 
    
    }  else{paste("There is no co data for",station)}#end if and else
      
    } #end plot function
  
  )# end map
  
) #end tagList

) #end suppressWarnings

```

```{r cohebdomadal}
suppressWarnings(
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("co")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
  # station<-"Abbotsford A Columbia Street"
    {
    
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("co"))%>%
        dplyr::mutate(weekday=factor(format(DATE_PST,"%a"),
                                     c("Sun",
                                        "Mon",
                                        "Tue",
                                        "Wed",
                                        "Thu",
                                        "Fri",
                                        "Sat")))
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p <- ggplot(
      data = plotData ,
      aes(
        x = weekday,
        #alter this for different boxplots
        y = ROUNDED_VALUE,
        fill = STATION_NAME_FULL
      )
    ) +
      geom_boxplot() +
      scale_x_discrete()+
      labs(
        title = paste("Hebdomadal Boxplot:",station),
        x = "",
        y = stringr::str_c(
          "Hourly co (",
          data %>%
            dplyr::filter(PARAMETER %in% toupper("co")) %>%
            dplyr::pull(UNIT) %>% unique,
          ")",
          sep = ""
        )
      ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      ) +
      scale_fill_brewer(palette = "Set1") +
      facet_wrap(~ INSTRUMENT, scales = "free")
    
    plotly::ggplotly(p)
    
    } else{paste("There is no co data for",station)}#end if and else
    
      
    } #end plot function
  
  )# end map
  
) #end tagList

) # end suppressWarnings

```

```{r codiurnal}
suppressWarnings(
  
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("co")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
  # station<-"Abbotsford A Columbia Street"
    {
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("co"))
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p <- ggplot(
      data = plotData,
      aes(
        x = format(DATE_PST,"%H"),
        #alter this for different boxplots
        y = ROUNDED_VALUE,
        fill = STATION_NAME_FULL
      )
    ) +
      geom_boxplot() +
      scale_x_discrete()+
      labs(
        title = paste("Diurnal Boxplot:",station),
        x = "",
        y = stringr::str_c(
          "Hourly co (",
          data %>%
            dplyr::filter(PARAMETER %in% toupper("co")) %>%
            dplyr::pull(UNIT) %>% unique,
          ")",
          sep = ""
        )
      ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      ) +
      scale_fill_brewer(palette = "Set1") +
      facet_wrap(~ INSTRUMENT, scales = "free")
    
    plotly::ggplotly(p)
    
    } else{paste("There is no co data for",station)}#end if and else
    
    } #end plot function
  
  )# end map
  
) #end tagList

) #end suppressWarnings

```

### TRS


```{r trsmonthly}

suppressWarnings(
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("trs")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
    
  
    {
    
    #FOR TESTING - 9 total
# (station<-(data %>%
#              dplyr::filter(PARAMETER %in% toupper("trs")) %>%
#              dplyr::pull(STATION_NAME_FULL) %>%
#              unique)[4])
    
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("trs"))
    
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p<-ggplot(data = plotData,
           aes(x = reorder(format(DATE_PST, "%b"), DATE_PST), #alter this for different boxplots
               y = ROUNDED_VALUE,
               fill=STATION_NAME_FULL)
           ) +
      geom_boxplot() +
      labs(title = paste("Monthly Boxplot:",
                         station),
           x = "",
           y = stringr::str_c("Hourly trs (",
                              data %>%
                                dplyr::filter(PARAMETER %in% toupper("trs")) %>%
                                dplyr::pull(UNIT) %>% unique, ")",
                              sep = ""
             )
           ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      )+ 
        scale_fill_brewer(palette = "Set1")+
      facet_wrap( ~ INSTRUMENT, scales = "free") 
    
  # Error in fix.by(by.y, y) : 'by' must specify uniquely valid columns
    plotly::ggplotly(p) 
    
    }  else{paste("There is no trs data for",station)}#end if and else
      
    } #end plot function
  
  )# end map
  
) #end tagList

) #end suppressWarnings

```

```{r trshebdomadal}
suppressWarnings(
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("trs")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
  # station<-"Abbotsford A Columbia Street"
    {
    
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("trs"))%>%
        dplyr::mutate(weekday=factor(format(DATE_PST,"%a"),
                                     c("Sun",
                                        "Mon",
                                        "Tue",
                                        "Wed",
                                        "Thu",
                                        "Fri",
                                        "Sat")))
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p <- ggplot(
      data = plotData ,
      aes(
        x = weekday,
        #alter this for different boxplots
        y = ROUNDED_VALUE,
        fill = STATION_NAME_FULL
      )
    ) +
      geom_boxplot() +
      scale_x_discrete()+
      labs(
        title = paste("Hebdomadal Boxplot:",station),
        x = "",
        y = stringr::str_c(
          "Hourly trs (",
          data %>%
            dplyr::filter(PARAMETER %in% toupper("trs")) %>%
            dplyr::pull(UNIT) %>% unique,
          ")",
          sep = ""
        )
      ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      ) +
      scale_fill_brewer(palette = "Set1") +
      facet_wrap(~ INSTRUMENT, scales = "free")
    
    plotly::ggplotly(p)
    
    } else{paste("There is no trs data for",station)}#end if and else
    
      
    } #end plot function
  
  )# end map
  
) #end tagList

) # end suppressWarnings

```

```{r trsdiurnal}
suppressWarnings(
  
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("trs")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
  # station<-"Abbotsford A Columbia Street"
    {
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("trs"))
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p <- ggplot(
      data = plotData,
      aes(
        x = format(DATE_PST,"%H"),
        #alter this for different boxplots
        y = ROUNDED_VALUE,
        fill = STATION_NAME_FULL
      )
    ) +
      geom_boxplot() +
      scale_x_discrete()+
      labs(
        title = paste("Diurnal Boxplot:",station),
        x = "",
        y = stringr::str_c(
          "Hourly trs (",
          data %>%
            dplyr::filter(PARAMETER %in% toupper("trs")) %>%
            dplyr::pull(UNIT) %>% unique,
          ")",
          sep = ""
        )
      ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      ) +
      scale_fill_brewer(palette = "Set1") +
      facet_wrap(~ INSTRUMENT, scales = "free")
    
    plotly::ggplotly(p)
    
    } else{paste("There is no trs data for",station)}#end if and else
    
    } #end plot function
  
  )# end map
  
) #end tagList

) #end suppressWarnings

```

### H~2~S

```{r h2smonthly}

suppressWarnings(
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("h2s")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
    
  
    {
    
    #FOR TESTING - 9 total
# (station<-(data %>%
#              dplyr::filter(PARAMETER %in% toupper("h2s")) %>%
#              dplyr::pull(STATION_NAME_FULL) %>%
#              unique)[4])
    
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("h2s"))
    
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p<-ggplot(data = plotData,
           aes(x = reorder(format(DATE_PST, "%b"), DATE_PST), #alter this for different boxplots
               y = ROUNDED_VALUE,
               fill=STATION_NAME_FULL)
           ) +
      geom_boxplot() +
      labs(title = paste("Monthly Boxplot:",
                         station),
           x = "",
           y = stringr::str_c("Hourly h2s (",
                              data %>%
                                dplyr::filter(PARAMETER %in% toupper("h2s")) %>%
                                dplyr::pull(UNIT) %>% unique, ")",
                              sep = ""
             )
           ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      )+ 
        scale_fill_brewer(palette = "Set1")+
      facet_wrap( ~ INSTRUMENT, scales = "free") 
    
  # Error in fix.by(by.y, y) : 'by' must specify uniquely valid columns
    plotly::ggplotly(p) 
    
    }  else{paste("There is no h2s data for",station)}#end if and else
      
    } #end plot function
  
  )# end map
  
) #end tagList

) #end suppressWarnings

```

```{r h2shebdomadal}
suppressWarnings(
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("h2s")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
  # station<-"Abbotsford A Columbia Street"
    {
    
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("h2s"))%>%
        dplyr::mutate(weekday=factor(format(DATE_PST,"%a"),
                                     c("Sun",
                                        "Mon",
                                        "Tue",
                                        "Wed",
                                        "Thu",
                                        "Fri",
                                        "Sat")))
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p <- ggplot(
      data = plotData ,
      aes(
        x = weekday,
        #alter this for different boxplots
        y = ROUNDED_VALUE,
        fill = STATION_NAME_FULL
      )
    ) +
      geom_boxplot() +
      scale_x_discrete()+
      labs(
        title = paste("Hebdomadal Boxplot:",station),
        x = "",
        y = stringr::str_c(
          "Hourly h2s (",
          data %>%
            dplyr::filter(PARAMETER %in% toupper("h2s")) %>%
            dplyr::pull(UNIT) %>% unique,
          ")",
          sep = ""
        )
      ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      ) +
      scale_fill_brewer(palette = "Set1") +
      facet_wrap(~ INSTRUMENT, scales = "free")
    
    plotly::ggplotly(p)
    
    } else{paste("There is no h2s data for",station)}#end if and else
    
      
    } #end plot function
  
  )# end map
  
) #end tagList

) # end suppressWarnings

```

```{r h2sdiurnal}
suppressWarnings(
  
  htmltools::tagList(
  
  purrr::map(data %>%
             dplyr::filter(PARAMETER %in% toupper("h2s")) %>%
             dplyr::pull(STATION_NAME_FULL) %>%
             unique,
  
  function(station)
  # station<-"Abbotsford A Columbia Street"
    {
    plotData<-data %>% 
             dplyr::filter(STATION_NAME_FULL %in% station &
                             PARAMETER %in% toupper("h2s"))
    if(nrow(plotData)!=plotData %>% 
      dplyr::summarise(nas=sum(is.na(ROUNDED_VALUE))) %>%
      dplyr::pull(nas)){
    
    p <- ggplot(
      data = plotData,
      aes(
        x = format(DATE_PST,"%H"),
        #alter this for different boxplots
        y = ROUNDED_VALUE,
        fill = STATION_NAME_FULL
      )
    ) +
      geom_boxplot() +
      scale_x_discrete()+
      labs(
        title = paste("Diurnal Boxplot:",station),
        x = "",
        y = stringr::str_c(
          "Hourly h2s (",
          data %>%
            dplyr::filter(PARAMETER %in% toupper("h2s")) %>%
            dplyr::pull(UNIT) %>% unique,
          ")",
          sep = ""
        )
      ) +
      theme_bw() +
      theme(
        # axis.text.x = element_text(
        #   # angle = 60,
        #   vjust = 1,
        #   hjust = 1
        # ),
        legend.position = "none",
        legend.title = element_blank()
      ) +
      scale_fill_brewer(palette = "Set1") +
      facet_wrap(~ INSTRUMENT, scales = "free")
    
    plotly::ggplotly(p)
    
    } else{paste("There is no h2s data for",station)}#end if and else
    
    } #end plot function
  
  )# end map
  
) #end tagList

) #end suppressWarnings

```


## Wind Roses

```{r windDataPrep}
# select wind data, get it in openair format

windData <- data %>%
  dplyr::filter(PARAMETER %in% c("WSPD_SCLR", "WDIR_VECT")) %>%
  dplyr::select(date = DATE_PST,
                STATION_NAME_FULL,
                PARAMETER,
                ROUNDED_VALUE) %>%
  tidyr::pivot_wider(.,
                     names_from = PARAMETER,
                     values_from = ROUNDED_VALUE) %>%
  dplyr::rename(ws = WSPD_SCLR,
                wd = WDIR_VECT) %>%
  dplyr::mutate(ws = ifelse(is.na(wd), NA, ws),
                wd = ifelse(is.na(ws), NA, wd))

```

```{r windRose}
purrr::walk(windData %>%
      dplyr::pull(STATION_NAME_FULL) %>%
      unique,
    
    function(station){
      # FOR TESTING
      # station<-"QUESNEL SENIOR SECONDARY MET_60"
      
      windData %<>%
        dplyr::filter(STATION_NAME_FULL %in% station)
      
      if(nrow(windData)==sum(is.na(windData$ws))){
        
        paste("There is no paired wind data at",station)
        
      } else {
      
      #number of calm hours
      ncalm <- windData %>%
        dplyr::filter(ws < 0.5) %>%
        dplyr::summarise(calms = n())
      
      #total number of valid ws hours
      ntotal <- windData %>%
        dplyr::filter(!is.na(ws)) %>%
        dplyr::summarise(total = n())
      
      #percentage calm (ws<0.5 m/s)
      pcalm <- round(100 * ncalm / ntotal,
                     digits = 2)
      
      #filter out calm windData
      roseData <- windData %>%
        dplyr::filter(ws >= 0.5)
      
      #windRose
      windRose(
        roseData,
        annotate = FALSE,
        breaks = c(0.5, 1.5, 3.3, 5.5, 7.9, 10.7, 13.8, 17.1),
        #Beaufort scale with 0.5 as lowest cut point.
        sub = paste("Calms (<0.5m/s)=", pcalm, "%"),
        key.position = "right",
        main = stringr::str_c("Wind Rose at ",station),
        angle = 360 / 16,
        #16 spokes
        cols = "jet",
        paddle = FALSE
      ) 
      
      } # end else
      
    } #end function(station)
    
    ) # map


```


## Minute Plots

For next year: minute data plotted above a year of hourly data  that is two separate figures plotted one above the other with negative values in a different colour

## SHARP drift

For next year: 3 channel SHARP 5030 neph drift is important to identify
